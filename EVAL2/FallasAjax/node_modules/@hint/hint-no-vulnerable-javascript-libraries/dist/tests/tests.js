"use strict";
/* eslint no-sync: 0 */
Object.defineProperty(exports, "__esModule", { value: true });
const fs = require("fs");
const utils_create_server_1 = require("@hint/utils-create-server");
const utils_tests_helpers_1 = require("@hint/utils-tests-helpers");
const utils_types_1 = require("@hint/utils-types");
const generateScriptTag = (script) => {
    return `<script>${script}</script>`;
};
const hintPath = utils_tests_helpers_1.getHintPath(__filename);
const angular = fs.readFileSync(require.resolve('angular/angular.min.js'), 'utf-8');
const jquery = fs.readFileSync(require.resolve('jquery/dist/jquery.min.js'), 'utf-8');
const knockout = fs.readFileSync(require.resolve('knockout/dist/knockout.js'), 'utf-8');
const moment = fs.readFileSync(require.resolve('moment/moment.js'), 'utf-8');
const defaultTests = [
    {
        name: `page with no libraries passes the hint`,
        serverConfig: utils_create_server_1.generateHTMLPage()
    },
    {
        name: `page with a vulnerable library (jquery 2.1.4) fails`,
        reports: [{
                message: `'jQuery@2.1.4' has 2 known vulnerabilities (2 medium). See 'https://snyk.io/vuln/npm:jquery' for more information.`,
                severity: utils_types_1.Severity.warning
            }],
        serverConfig: utils_create_server_1.generateHTMLPage(generateScriptTag(jquery))
    },
    {
        name: `page with a library with a tagged version and vulnerabilities (knockout 3.4.0-rc) fails`,
        reports: [{
                message: `'Knockout@3.4.0rc' has 1 known vulnerability (1 medium). See 'https://snyk.io/vuln/npm:knockout' for more information.`,
                severity: utils_types_1.Severity.warning
            }],
        serverConfig: utils_create_server_1.generateHTMLPage(generateScriptTag(knockout))
    },
    {
        name: `page with non vulnerable library (moment 2.22.2) passes`,
        serverConfig: utils_create_server_1.generateHTMLPage(generateScriptTag(moment))
    }
];
const userHighConfigTests = [
    {
        name: `page with a library with vulnerabilities medium or lower passes if configured severity is "high"`,
        serverConfig: utils_create_server_1.generateHTMLPage(generateScriptTag(jquery))
    },
    {
        name: `page with a library with vulnerabilities high fails if configured severity is "high"`,
        reports: [{
                message: `'AngularJS@1.4.9' has 3 known vulnerabilities (3 high). See 'https://snyk.io/vuln/npm:angular' for more information.`,
                severity: utils_types_1.Severity.error
            }],
        serverConfig: utils_create_server_1.generateHTMLPage(generateScriptTag(angular))
    }
];
const userMediumConfigTests = [
    {
        name: `page with a library with vulnerabilities medium fails if configured severity is "medium"`,
        reports: [{
                message: `'jQuery@2.1.4' has 2 known vulnerabilities (2 medium). See 'https://snyk.io/vuln/npm:jquery' for more information.`,
                severity: utils_types_1.Severity.warning
            }],
        serverConfig: utils_create_server_1.generateHTMLPage(generateScriptTag(jquery))
    },
    {
        name: `page with a library with vulnerabilities high fails if configured severity is "medium"`,
        reports: [{
                message: `'AngularJS@1.4.9' has 13 known vulnerabilities (10 medium, 3 high). See 'https://snyk.io/vuln/npm:angular' for more information.`,
                severity: utils_types_1.Severity.error
            }],
        serverConfig: utils_create_server_1.generateHTMLPage(generateScriptTag(angular))
    }
];
utils_tests_helpers_1.testHint(hintPath, defaultTests);
utils_tests_helpers_1.testHint(hintPath, userHighConfigTests, { hintOptions: { severity: 'high' } });
utils_tests_helpers_1.testHint(hintPath, userMediumConfigTests, { hintOptions: { severity: 'medium' } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi90ZXN0cy90ZXN0cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsdUJBQXVCOztBQUV2Qix5QkFBeUI7QUFFekIsbUVBQTZEO0FBQzdELG1FQUE0RTtBQUM1RSxtREFBNkM7QUFFN0MsTUFBTSxpQkFBaUIsR0FBRyxDQUFDLE1BQWMsRUFBRSxFQUFFO0lBQ3pDLE9BQU8sV0FBVyxNQUFNLFdBQVcsQ0FBQztBQUN4QyxDQUFDLENBQUM7QUFFRixNQUFNLFFBQVEsR0FBRyxpQ0FBVyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBRXpDLE1BQU0sT0FBTyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyx3QkFBd0IsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQ3BGLE1BQU0sTUFBTSxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQywyQkFBMkIsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQ3RGLE1BQU0sUUFBUSxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQywyQkFBMkIsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQ3hGLE1BQU0sTUFBTSxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBRzdFLE1BQU0sWUFBWSxHQUFlO0lBQzdCO1FBQ0ksSUFBSSxFQUFFLHdDQUF3QztRQUM5QyxZQUFZLEVBQUUsc0NBQWdCLEVBQUU7S0FDbkM7SUFDRDtRQUNJLElBQUksRUFBRSxxREFBcUQ7UUFDM0QsT0FBTyxFQUFFLENBQUM7Z0JBQ04sT0FBTyxFQUFFLG9IQUFvSDtnQkFDN0gsUUFBUSxFQUFFLHNCQUFRLENBQUMsT0FBTzthQUM3QixDQUFDO1FBQ0YsWUFBWSxFQUFFLHNDQUFnQixDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxDQUFDO0tBQzVEO0lBQ0Q7UUFDSSxJQUFJLEVBQUUseUZBQXlGO1FBQy9GLE9BQU8sRUFBRSxDQUFDO2dCQUNOLE9BQU8sRUFBRSx3SEFBd0g7Z0JBQ2pJLFFBQVEsRUFBRSxzQkFBUSxDQUFDLE9BQU87YUFDN0IsQ0FBQztRQUNGLFlBQVksRUFBRSxzQ0FBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztLQUM5RDtJQUNEO1FBQ0ksSUFBSSxFQUFFLHlEQUF5RDtRQUMvRCxZQUFZLEVBQUUsc0NBQWdCLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLENBQUM7S0FDNUQ7Q0FDSixDQUFDO0FBRUYsTUFBTSxtQkFBbUIsR0FBZTtJQUNwQztRQUNJLElBQUksRUFBRSxrR0FBa0c7UUFDeEcsWUFBWSxFQUFFLHNDQUFnQixDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxDQUFDO0tBQzVEO0lBQ0Q7UUFDSSxJQUFJLEVBQUUsc0ZBQXNGO1FBQzVGLE9BQU8sRUFBRSxDQUFDO2dCQUNOLE9BQU8sRUFBRSxzSEFBc0g7Z0JBQy9ILFFBQVEsRUFBRSxzQkFBUSxDQUFDLEtBQUs7YUFDM0IsQ0FBQztRQUNGLFlBQVksRUFBRSxzQ0FBZ0IsQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztLQUM3RDtDQUNKLENBQUM7QUFFRixNQUFNLHFCQUFxQixHQUFlO0lBQ3RDO1FBQ0ksSUFBSSxFQUFFLDBGQUEwRjtRQUNoRyxPQUFPLEVBQUUsQ0FBQztnQkFDTixPQUFPLEVBQUUsb0hBQW9IO2dCQUM3SCxRQUFRLEVBQUUsc0JBQVEsQ0FBQyxPQUFPO2FBQzdCLENBQUM7UUFDRixZQUFZLEVBQUUsc0NBQWdCLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLENBQUM7S0FDNUQ7SUFDRDtRQUNJLElBQUksRUFBRSx3RkFBd0Y7UUFDOUYsT0FBTyxFQUFFLENBQUM7Z0JBQ04sT0FBTyxFQUFFLGtJQUFrSTtnQkFDM0ksUUFBUSxFQUFFLHNCQUFRLENBQUMsS0FBSzthQUMzQixDQUFDO1FBQ0YsWUFBWSxFQUFFLHNDQUFnQixDQUFDLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxDQUFDO0tBQzdEO0NBQ0osQ0FBQztBQUVGLDhCQUFRLENBQUMsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDO0FBQ2pDLDhCQUFRLENBQUMsUUFBUSxFQUFFLG1CQUFtQixFQUFFLEVBQUUsV0FBVyxFQUFFLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxFQUFFLENBQUMsQ0FBQztBQUMvRSw4QkFBUSxDQUFDLFFBQVEsRUFBRSxxQkFBcUIsRUFBRSxFQUFFLFdBQVcsRUFBRSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsRUFBRSxDQUFDLENBQUMifQ==