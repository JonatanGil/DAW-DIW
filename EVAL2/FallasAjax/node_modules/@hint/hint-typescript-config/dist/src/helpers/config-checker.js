"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const i18n_import_1 = require("../i18n.import");
const findValue = (property, config) => {
    const properties = property.split('.');
    let current = config[properties.shift() || ''];
    while (properties.length > 0 && typeof current !== 'undefined') {
        current = current[properties.shift() || ''];
    }
    return current;
};
exports.findValue = findValue;
const findLocation = (propertyPath, mergedConfig, originalConfig, getLocation) => {
    const valueInOriginal = findValue(propertyPath, originalConfig);
    if (typeof valueInOriginal !== 'undefined') {
        return getLocation(propertyPath, { at: 'value' });
    }
    const valueInMerged = findValue(propertyPath, mergedConfig);
    if (typeof valueInMerged !== 'undefined') {
        return getLocation('extends', { at: 'value' });
    }
    const ancestors = propertyPath.split('.').slice(0, -1);
    while (ancestors.length > 0) {
        const ancestor = ancestors.pop();
        if (ancestor && ancestor in originalConfig) {
            return getLocation(ancestor);
        }
    }
    return null;
};
exports.findLocation = findLocation;
/** Helper method to check if a property matches the desired value and report an issue if not. */
const configChecker = (property, desiredValue, messageName, context, severity) => {
    return (evt) => {
        const { config, getLocation, mergedConfig, originalConfig, resource } = evt;
        const current = findValue(property, config);
        if (current !== desiredValue) {
            const location = findLocation(property, mergedConfig, originalConfig, getLocation);
            const message = i18n_import_1.getMessage(messageName, context.language);
            context.report(resource, message, { location, severity });
        }
    };
};
exports.configChecker = configChecker;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlnLWNoZWNrZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvaGVscGVycy9jb25maWctY2hlY2tlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUtBLGdEQUF5RDtBQUV6RCxNQUFNLFNBQVMsR0FBRyxDQUFDLFFBQWdCLEVBQUUsTUFBd0IsRUFBRSxFQUFFO0lBQzdELE1BQU0sVUFBVSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFdkMsSUFBSSxPQUFPLEdBQUksTUFBYyxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUV4RCxPQUFPLFVBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLE9BQU8sT0FBTyxLQUFLLFdBQVcsRUFBRTtRQUM1RCxPQUFPLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztLQUMvQztJQUVELE9BQU8sT0FBTyxDQUFDO0FBQ25CLENBQUMsQ0FBQztBQTRDb0MsOEJBQVM7QUExQy9DLE1BQU0sWUFBWSxHQUFHLENBQUMsWUFBb0IsRUFBRSxZQUE4QixFQUFFLGNBQWdDLEVBQUUsV0FBaUMsRUFBRSxFQUFFO0lBQy9JLE1BQU0sZUFBZSxHQUFHLFNBQVMsQ0FBQyxZQUFZLEVBQUUsY0FBYyxDQUFDLENBQUM7SUFFaEUsSUFBSSxPQUFPLGVBQWUsS0FBSyxXQUFXLEVBQUU7UUFDeEMsT0FBTyxXQUFXLENBQUMsWUFBWSxFQUFFLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7S0FDckQ7SUFFRCxNQUFNLGFBQWEsR0FBRyxTQUFTLENBQUMsWUFBWSxFQUFFLFlBQVksQ0FBQyxDQUFDO0lBRTVELElBQUksT0FBTyxhQUFhLEtBQUssV0FBVyxFQUFFO1FBQ3RDLE9BQU8sV0FBVyxDQUFDLFNBQVMsRUFBRSxFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDO0tBQ2xEO0lBRUQsTUFBTSxTQUFTLEdBQUcsWUFBWSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFdkQsT0FBTyxTQUFTLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtRQUN6QixNQUFNLFFBQVEsR0FBRyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUM7UUFFakMsSUFBSSxRQUFRLElBQUksUUFBUSxJQUFJLGNBQWMsRUFBRTtZQUN4QyxPQUFPLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUNoQztLQUNKO0lBRUQsT0FBTyxJQUFJLENBQUM7QUFDaEIsQ0FBQyxDQUFDO0FBa0JzQixvQ0FBWTtBQWhCcEMsaUdBQWlHO0FBQ2pHLE1BQU0sYUFBYSxHQUFHLENBQUMsUUFBZ0IsRUFBRSxZQUFxQixFQUFFLFdBQXdCLEVBQUUsT0FBb0IsRUFBRSxRQUFrQixFQUFFLEVBQUU7SUFFbEksT0FBTyxDQUFDLEdBQTBCLEVBQUUsRUFBRTtRQUNsQyxNQUFNLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxZQUFZLEVBQUUsY0FBYyxFQUFFLFFBQVEsRUFBRSxHQUFHLEdBQUcsQ0FBQztRQUM1RSxNQUFNLE9BQU8sR0FBRyxTQUFTLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBRTVDLElBQUksT0FBTyxLQUFLLFlBQVksRUFBRTtZQUMxQixNQUFNLFFBQVEsR0FBRyxZQUFZLENBQUMsUUFBUSxFQUFFLFlBQVksRUFBRSxjQUFjLEVBQUUsV0FBVyxDQUFDLENBQUM7WUFDbkYsTUFBTSxPQUFPLEdBQUcsd0JBQVUsQ0FBQyxXQUFXLEVBQUUsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRTFELE9BQU8sQ0FBQyxNQUFNLENBQUMsUUFBUSxFQUFFLE9BQU8sRUFBRSxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDO1NBQzdEO0lBQ0wsQ0FBQyxDQUFDO0FBQ04sQ0FBQyxDQUFDO0FBRU8sc0NBQWEifQ==