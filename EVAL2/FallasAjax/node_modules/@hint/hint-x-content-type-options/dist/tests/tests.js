"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const utils_types_1 = require("@hint/utils-types");
const utils_create_server_1 = require("@hint/utils-create-server");
const utils_tests_helpers_1 = require("@hint/utils-tests-helpers");
// Page data.
const pageWithAlternateStylesheet = utils_create_server_1.generateHTMLPage('<link rel="  alternate stylesheet " href="test.css">');
const pageWithScript = utils_create_server_1.generateHTMLPage(undefined, '<script src="test.js"></script>');
const pageWithScriptAndStylesheet = utils_create_server_1.generateHTMLPage('<link rel="stylesheet" href="test.css">', '<script src="test.js"></script>');
const pageWithStylesheet = utils_create_server_1.generateHTMLPage('<link rel="stylesheet" href="test.css">');
// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
// Error messages.
const noHeaderErrorMessage = `Response should include 'x-content-type-options' header.`;
const generateInvalidValueMessage = (value = '') => {
    return `'x-content-type-options' header value should be 'nosniff', not '${value}'.`;
};
// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
// Tests.
const tests = [
    {
        name: `HTML page is served without 'X-Content-Type-Options' header`,
        reports: [{
                message: noHeaderErrorMessage,
                severity: utils_types_1.Severity.error
            }],
        serverConfig: {
            '/': { content: utils_create_server_1.generateHTMLPage() },
            '/favicon.ico': { headers: { 'X-Content-Type-Options': 'nosniff' } }
        }
    },
    {
        name: `Favicon is served without 'X-Content-Type-Options' header`,
        reports: [{
                message: noHeaderErrorMessage,
                severity: utils_types_1.Severity.error
            }],
        serverConfig: {
            '/': { content: utils_create_server_1.generateHTMLPage(), headers: { 'Content-Type': 'text/html', 'X-Content-Type-Options': 'nosniff' } },
            '/favicon.ico': ''
        }
    },
    {
        name: `Stylesheet is served without 'X-Content-Type-Options' header`,
        reports: [{
                message: noHeaderErrorMessage,
                severity: utils_types_1.Severity.error
            }],
        serverConfig: {
            '/': { content: pageWithStylesheet, headers: { 'Content-Type': 'text/html', 'X-Content-Type-Options': 'nosniff' } },
            '/favicon.ico': { headers: { 'X-Content-Type-Options': 'nosniff' } },
            '/test.css': ''
        }
    },
    {
        name: `Alternate stylesheet is served without 'X-Content-Type-Options' header`,
        reports: [{
                message: noHeaderErrorMessage,
                severity: utils_types_1.Severity.error
            }],
        serverConfig: {
            '/': { content: pageWithAlternateStylesheet, headers: { 'Content-Type': 'text/html', 'X-Content-Type-Options': 'nosniff' } },
            '/favicon.ico': { headers: { 'X-Content-Type-Options': 'nosniff' } },
            '/test.css': ''
        }
    },
    {
        name: `Resource is specified as a data URI`,
        serverConfig: {
            '/': {
                content: utils_create_server_1.generateHTMLPage(undefined, '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACklEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==">'),
                headers: { 'X-Content-Type-Options': 'nosniff' }
            },
            '/favicon.ico': { headers: { 'X-Content-Type-Options': 'nosniff' } }
        }
    },
    {
        name: `Script is served with 'X-Content-Type-Options' header with invalid value`,
        reports: [{
                message: generateInvalidValueMessage('invalid'),
                severity: utils_types_1.Severity.error
            }],
        serverConfig: {
            '/': { content: pageWithScript, headers: { 'Content-Type': 'text/html', 'X-Content-Type-Options': 'nosniff' } },
            '/favicon.ico': { headers: { 'X-Content-Type-Options': 'nosniff' } },
            '/test.js': { headers: { 'X-Content-Type-Options': 'invalid' } }
        }
    },
    {
        name: `All resources are served with 'X-Content-Type-Options' header`,
        serverConfig: { '*': { content: pageWithScriptAndStylesheet, headers: { 'Content-Type': 'text/html', 'X-Content-Type-Options': 'nosniff' } } }
    }
];
utils_tests_helpers_1.testHint(utils_tests_helpers_1.getHintPath(__filename), tests);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVzdHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi90ZXN0cy90ZXN0cy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG1EQUE2QztBQUM3QyxtRUFBNkQ7QUFDN0QsbUVBQTRFO0FBRTVFLGFBQWE7QUFFYixNQUFNLDJCQUEyQixHQUFHLHNDQUFnQixDQUFDLHNEQUFzRCxDQUFDLENBQUM7QUFDN0csTUFBTSxjQUFjLEdBQUcsc0NBQWdCLENBQUMsU0FBUyxFQUFFLGlDQUFpQyxDQUFDLENBQUM7QUFDdEYsTUFBTSwyQkFBMkIsR0FBRyxzQ0FBZ0IsQ0FBQyx5Q0FBeUMsRUFBRSxpQ0FBaUMsQ0FBQyxDQUFDO0FBQ25JLE1BQU0sa0JBQWtCLEdBQUcsc0NBQWdCLENBQUMseUNBQXlDLENBQUMsQ0FBQztBQUV2Rix3RUFBd0U7QUFFeEUsa0JBQWtCO0FBRWxCLE1BQU0sb0JBQW9CLEdBQUcsMERBQTBELENBQUM7QUFDeEYsTUFBTSwyQkFBMkIsR0FBRyxDQUFDLFFBQWdCLEVBQUUsRUFBRSxFQUFFO0lBQ3ZELE9BQU8sbUVBQW1FLEtBQUssSUFBSSxDQUFDO0FBQ3hGLENBQUMsQ0FBQztBQUVGLHdFQUF3RTtBQUV4RSxTQUFTO0FBRVQsTUFBTSxLQUFLLEdBQWU7SUFDdEI7UUFDSSxJQUFJLEVBQUUsNkRBQTZEO1FBQ25FLE9BQU8sRUFBRSxDQUFDO2dCQUNOLE9BQU8sRUFBRSxvQkFBb0I7Z0JBQzdCLFFBQVEsRUFBRSxzQkFBUSxDQUFDLEtBQUs7YUFDM0IsQ0FBQztRQUNGLFlBQVksRUFBRTtZQUNWLEdBQUcsRUFBRSxFQUFFLE9BQU8sRUFBRSxzQ0FBZ0IsRUFBRSxFQUFFO1lBQ3BDLGNBQWMsRUFBRSxFQUFFLE9BQU8sRUFBRSxFQUFFLHdCQUF3QixFQUFFLFNBQVMsRUFBRSxFQUFFO1NBQ3ZFO0tBQ0o7SUFDRDtRQUNJLElBQUksRUFBRSwyREFBMkQ7UUFDakUsT0FBTyxFQUFFLENBQUM7Z0JBQ04sT0FBTyxFQUFF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