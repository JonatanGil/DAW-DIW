"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const utils_debug_1 = require("@hint/utils-debug");
const utils_types_1 = require("@hint/utils-types");
const modules_false_babel_1 = require("./meta/modules-false-babel");
const i18n_import_1 = require("./i18n.import");
const debug = utils_debug_1.debug(__filename);
/*
 * ------------------------------------------------------------------------------
 * Public
 * ------------------------------------------------------------------------------
 */
class WebpackConfigModulesFalseBabel {
    constructor(context) {
        let webpackEvent;
        let babelEvent;
        const webpackConfigReceived = (webpackConfigEvent) => {
            debug(`'parse::end::webpack-config' received`);
            webpackEvent = webpackConfigEvent;
        };
        const babelConfigReceived = (babelConfigEvent) => {
            debug(`'parse::end::babel-config' received`);
            babelEvent = babelConfigEvent;
        };
        const validate = () => {
            if (!webpackEvent) {
                debug(`no 'parse::end::webpack-config' received`);
                return;
            }
            if (!babelEvent) {
                debug(`no 'parse::end::babel-config' received`);
                return;
            }
            const version = parseInt(webpackEvent.version);
            const presets = babelEvent.config.presets;
            if (version < 2 || !presets || presets.length === 0) {
                return;
            }
            const modulesFalse = presets.filter((preset) => {
                return preset.length > 1 && preset[1].modules === false;
            });
            if (modulesFalse.length === 0) {
                context.report(babelEvent.resource, i18n_import_1.getMessage('babelModules', context.language), { severity: utils_types_1.Severity.error });
            }
        };
        context.on('parse::end::webpack-config', webpackConfigReceived);
        context.on('parse::end::babel-config', babelConfigReceived);
        context.on('scan::end', validate);
    }
}
exports.default = WebpackConfigModulesFalseBabel;
WebpackConfigModulesFalseBabel.meta = modules_false_babel_1.default;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kdWxlcy1mYWxzZS1iYWJlbC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tb2R1bGVzLWZhbHNlLWJhYmVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBSUEsbURBQStDO0FBQy9DLG1EQUE2QztBQUs3QyxvRUFBOEM7QUFDOUMsK0NBQTJDO0FBRTNDLE1BQU0sS0FBSyxHQUFvQixtQkFBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBRTdDOzs7O0dBSUc7QUFFSCxNQUFxQiw4QkFBOEI7SUFHL0MsWUFBbUIsT0FBNkQ7UUFFNUUsSUFBSSxZQUFnQyxDQUFDO1FBQ3JDLElBQUksVUFBNkIsQ0FBQztRQUVsQyxNQUFNLHFCQUFxQixHQUFHLENBQUMsa0JBQXNDLEVBQUUsRUFBRTtZQUNyRSxLQUFLLENBQUMsdUNBQXVDLENBQUMsQ0FBQztZQUUvQyxZQUFZLEdBQUcsa0JBQWtCLENBQUM7UUFDdEMsQ0FBQyxDQUFDO1FBRUYsTUFBTSxtQkFBbUIsR0FBRyxDQUFDLGdCQUFtQyxFQUFFLEVBQUU7WUFDaEUsS0FBSyxDQUFDLHFDQUFxQyxDQUFDLENBQUM7WUFFN0MsVUFBVSxHQUFHLGdCQUFnQixDQUFDO1FBQ2xDLENBQUMsQ0FBQztRQUVGLE1BQU0sUUFBUSxHQUFHLEdBQUcsRUFBRTtZQUNsQixJQUFJLENBQUMsWUFBWSxFQUFFO2dCQUNmLEtBQUssQ0FBQywwQ0FBMEMsQ0FBQyxDQUFDO2dCQUVsRCxPQUFPO2FBQ1Y7WUFFRCxJQUFJLENBQUMsVUFBVSxFQUFFO2dCQUNiLEtBQUssQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFDO2dCQUVoRCxPQUFPO2FBQ1Y7WUFFRCxNQUFNLE9BQU8sR0FBRyxRQUFRLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQy9DLE1BQU0sT0FBTyxHQUFHLFVBQVUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDO1lBRTFDLElBQUksT0FBTyxHQUFHLENBQUMsSUFBSSxDQUFDLE9BQU8sSUFBSSxPQUFPLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRTtnQkFDakQsT0FBTzthQUNWO1lBRUQsTUFBTSxZQUFZLEdBQUksT0FBbUIsQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLEVBQUUsRUFBRTtnQkFDeEQsT0FBTyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxLQUFLLEtBQUssQ0FBQztZQUM1RCxDQUFDLENBQUMsQ0FBQztZQUVILElBQUksWUFBWSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7Z0JBQzNCLE9BQU8sQ0FBQyxNQUFNLENBQ1YsVUFBVSxDQUFDLFFBQVEsRUFDbkIsd0JBQVUsQ0FBQyxjQUFjLEVBQUUsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUM1QyxFQUFFLFFBQVEsRUFBRSxzQkFBUSxDQUFDLEtBQUssRUFBRSxDQUMvQixDQUFDO2FBQ0w7UUFDTCxDQUFDLENBQUM7UUFFRixPQUFPLENBQUMsRUFBRSxDQUFDLDRCQUE0QixFQUFFLHFCQUFxQixDQUFDLENBQUM7UUFDaEUsT0FBTyxDQUFDLEVBQUUsQ0FBQywwQkFBMEIsRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO1FBQzVELE9BQU8sQ0FBQyxFQUFFLENBQUMsV0FBVyxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQ3RDLENBQUM7O0FBeERMLGlEQXlEQztBQXhEMEIsbUNBQUksR0FBRyw2QkFBSSxDQUFDIn0=