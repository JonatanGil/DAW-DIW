"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
/**
 * @fileoverview Check if responses served over HTTPS also have the Strict-Transport-Security header with a proper value max-age value.
 */
const url = require("url");
const url_1 = require("url"); // this is necessary to avoid TypeScript mixes types.
const utils_network_1 = require("@hint/utils-network");
const utils_debug_1 = require("@hint/utils-debug");
const utils_types_1 = require("@hint/utils-types");
const meta_1 = require("./meta");
const i18n_import_1 = require("./i18n.import");
const debug = utils_debug_1.debug(__filename);
/*
 * ------------------------------------------------------------------------------
 * Public
 * ------------------------------------------------------------------------------
 */
class StrictTransportSecurityHint {
    constructor(context) {
        /** The minimum period (in seconds) allowed for `max-age`. */
        let minMaxAgeValue;
        /** Whether or not check the preload attribute */
        let checkPreload;
        /** Endpoint to verify that the domain name has already been included in the `preload list` */
        const statusApiEndPoint = `https://hstspreload.org/api/v2/status?domain=`;
        /** Endpoint to verify that the domain name is qualified to be preloaded */
        const preloadableApiEndPoint = `https://hstspreload.org/api/v2/preloadable?domain=`;
        /** Set of unsupported domains to avoid make unnecessary requests. */
        const unsupportedDomains = new Set();
        /*
         * HACK: Need to do a require here in order to be capable of mocking
         * when testing the hint and `import` doesn't work here.
         */
        const { isHTTPS, requestJSONAsync } = require('@hint/utils-network');
        const { normalizeString } = require('@hint/utils-string');
        const loadHintConfigs = () => {
            minMaxAgeValue = (context.hintOptions && context.hintOptions.minMaxAgeValue) || 10886400; // 18 weeks
            checkPreload = (context.hintOptions && context.hintOptions.checkPreload);
        };
        /*
         * STS header Syntax:
         * Strict-Transport-Security: max-age=<expire-time>
         * Strict-Transport-Security: max-age=<expire-time>; includeSubDomains
         * Strict-Transport-Security: max-age=<expire-time>; preload
         * This function accomplishes the following:
         * "max-age=31536000; includesubdomains; preload" => {"max-age":31536000,"includesubdomains":true,"preload":true}
         */
        const parse = (headerValue) => {
            const parsedHeader = {};
            const directives = headerValue.toLowerCase().split(';');
            const nameValuePairRegex = /^ *([!#$%&'*+.^_`|~0-9A-Za-z-]+) *= *("(?:[~0-9])*"|[!#$%&'*+.^_`|~0-9]+) *$/;
            /*
             * Regex for name-value pairs. E.g.: max-age=31536000
             * Modified usage of https://github.com/jshttp/content-type/blob/64bde0d996ccb4334341662c0c7d25f7b370c4d9/index.js#L23
             */
            const tokenRegex = /^ *[!#$%&'*+.^_`|~0-9A-Za-z-]+$/; // Regex for single tokens. E.g.:  includesubdomains
            for (const directive of directives) {
                const match = tokenRegex.exec(directive) || nameValuePairRegex.exec(directive);
                if (!match) {
                    return {
                        error: {
                            message: i18n_import_1.getMessage('wrongFormat', context.language, directive),
                            severity: utils_types_1.Severity.error
                        }
                    };
                }
                const [matchString, key, value] = match;
                const name = key || matchString.trim();
                if (parsedHeader[name]) {
                    return {
                        error: {
                            message: i18n_import_1.getMessage('moreThanOneName', context.language, name),
                            severity: utils_types_1.Severity.warning
                        }
                    };
                }
                parsedHeader[name] = value || 'true';
            }
            return { parsedHeader };
        };
        const isUnderAgeLimit = (maxAge, limit) => {
            return !!maxAge && parseInt(maxAge) < limit;
        };
        const isPreloaded = (hostname) => {
            debug(`Waiting to get preload status for ${hostname}`);
            return requestJSONAsync(`${statusApiEndPoint}${hostname}`);
        };
        const issuesToPreload = (hostname) => {
            debug(`Waiting to get preload eligibility for ${hostname}`);
            return requestJSONAsync(`${preloadableApiEndPoint}${hostname}`);
        };
        const verifyPreload = async (resource) => {
            const originalDomain = new url_1.URL(resource).hostname;
            const mainDomain = originalDomain.replace(/^www./, '');
            // Some hostnames in the list include `www.`, e.g., `www.gov.uk`.
            let status;
            let issues = {};
            try {
                ({ status } = await isPreloaded(mainDomain) || await isPreloaded(originalDomain));
            }
            catch (err) {
                const message = i18n_import_1.getMessage('errorPreloadStatus', context.language, resource);
                debug(message, err);
                context.report(resource, message, { severity: utils_types_1.Severity.error });
                return issues;
            }
            debug(`Received preload status for ${resource}.`);
            if (!status) {
                const message = i18n_import_1.getMessage('wrongVerification', context.language, i18n_import_1.getMessage('errorPreloadStatus', context.language, resource));
                debug(message);
                context.report(resource, message, { severity: utils_types_1.Severity.warning });
                return issues;
            }
            if (status !== 'preloaded') {
                try {
                    issues = await issuesToPreload(mainDomain);
                }
                catch (err) {
                    const message = i18n_import_1.getMessage('errorPreloadEligibility', context.language, resource);
                    debug(message, err);
                    context.report(resource, message, { severity: utils_types_1.Severity.error });
                }
                debug(`Received preload eligibility for ${resource}.`);
            }
            return issues;
        };
        const validate = async ({ element, resource, response }) => {
            if (!utils_network_1.isRegularProtocol(resource)) {
                debug(`Check does not apply for non HTTP(s) URIs`);
                return;
            }
            const headerValue = normalizeString(response.headers && response.headers['strict-transport-security']);
            if (!isHTTPS(resource) && headerValue) {
                const message = i18n_import_1.getMessage('noOverHTTP', context.language);
                context.report(resource, message, {
                    codeLanguage: 'http',
                    codeSnippet: `Strict-Transport-Security: ${headerValue}`,
                    element,
                    severity: utils_types_1.Severity.warning
                });
                return;
            }
            if (!isHTTPS(resource) && !headerValue) {
                const urlObject = new url_1.URL(resource);
                if (unsupportedDomains.has(urlObject.host)) {
                    debug(`${resource} ignored because the domain ${urlObject.host} does not support HTTPS.`);
                    return;
                }
                const httpsResource = url.format(Object.assign(urlObject, { protocol: `https` }));
                try {
                    const networkData = await context.fetchContent(httpsResource);
                    if (!networkData || !networkData.response) {
                        return;
                    }
                    if (networkData.response.statusCode === 200) {
                        validate({
                            element: null,
                            request: networkData.request,
                            resource: httpsResource,
                            response: networkData.response
                        });
                    }
                }
                catch (err) {
                    // HTTPS site can't be fetched, do nothing.
                    debug(`${resource} doesn't support HTTPS`);
                    /*
                     * If the HTTPS resource can't be fetched,
                     * add the domain to the unsupported list.
                     */
                    unsupportedDomains.add(urlObject.host);
                }
                return;
            }
            // Check if the header `Strict-Transport-Security` is sent for resources served over HTTPS.
            if (!headerValue) {
                context.report(resource, i18n_import_1.getMessage('noHeader', context.language), {
                    element,
                    severity: utils_types_1.Severity.error
                });
                return;
            }
            // Parse header and report repetitive attributes
            const { error, parsedHeader } = parse(headerValue);
            if (error) {
                context.report(resource, error.message, {
                    element,
                    severity: error.severity
                });
                return;
            }
            // Required to make TS happy
            if (!parsedHeader) {
                return;
            }
            // Verify preload attribute
            if (checkPreload && parsedHeader.preload) {
                const { errors } = await verifyPreload(resource);
                if (errors) {
                    for (const error of errors) {
                        context.report(resource, error.message, { element, severity: utils_types_1.Severity.error });
                    }
                    return;
                }
            }
            const maxAge = parsedHeader['max-age'];
            // Check if header `Strict-Transport-Security` contains `max-age` directive.
            if (!maxAge) {
                const message = i18n_import_1.getMessage('requiresMaxAge', context.language);
                context.report(resource, message, { element, severity: utils_types_1.Severity.error });
                return;
            }
            // Check if the `max-age` value is smaller than the minimum of max-age defined
            if (isUnderAgeLimit(maxAge, minMaxAgeValue)) {
                const message = i18n_import_1.getMessage('wrongMaxAge', context.language, minMaxAgeValue.toString());
                context.report(resource, message, {
                    codeLanguage: 'http',
                    codeSnippet: `Strict-Transport-Security: ${headerValue}`,
                    element,
                    severity: utils_types_1.Severity.warning
                });
                return;
            }
        };
        loadHintConfigs();
        context.on('fetch::end::*', validate);
    }
}
exports.default = StrictTransportSecurityHint;
StrictTransportSecurityHint.meta = meta_1.default;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGludC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9oaW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7O0dBRUc7QUFDSCwyQkFBMkI7QUFDM0IsNkJBQTBCLENBQUMscURBQXFEO0FBRWhGLHVEQUF3RDtBQUN4RCxtREFBK0M7QUFFL0MsbURBQTZDO0FBRTdDLGlDQUEwQjtBQUMxQiwrQ0FBMkM7QUFFM0MsTUFBTSxLQUFLLEdBQUcsbUJBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUU1Qjs7OztHQUlHO0FBRUgsTUFBcUIsMkJBQTJCO0lBSTVDLFlBQW1CLE9BQW9CO1FBRW5DLDZEQUE2RDtRQUM3RCxJQUFJLGNBQXNCLENBQUM7UUFDM0IsaURBQWlEO1FBQ2pELElBQUksWUFBcUIsQ0FBQztRQUMxQiw4RkFBOEY7UUFDOUYsTUFBTSxpQkFBaUIsR0FBRywrQ0FBK0MsQ0FBQztRQUMxRSwyRUFBMkU7UUFDM0UsTUFBTSxzQkFBc0IsR0FBRyxvREFBb0QsQ0FBQztRQUNwRixxRUFBcUU7UUFDckUsTUFBTSxrQkFBa0IsR0FBZ0IsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUVsRDs7O1dBR0c7UUFDSCxNQUFNLEVBQUUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLEdBQUcsT0FBTyxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFDckUsTUFBTSxFQUFFLGVBQWUsRUFBRSxHQUFHLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1FBRTFELE1BQU0sZUFBZSxHQUFHLEdBQUcsRUFBRTtZQUN6QixjQUFjLEdBQUcsQ0FBQyxPQUFPLENBQUMsV0FBVyxJQUFJLE9BQU8sQ0FBQyxXQUFXLENBQUMsY0FBYyxDQUFDLElBQUksUUFBUSxDQUFDLENBQUMsV0FBVztZQUNyRyxZQUFZLEdBQUcsQ0FBQyxPQUFPLENBQUMsV0FBVyxJQUFJLE9BQU8sQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDN0UsQ0FBQyxDQUFDO1FBRUY7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