"use strict";
/**
 * @fileoverview This hint validates the `set-cookie` header and confirms that it is sent with `Secure` and `HttpOnly` directive over HTTPS.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const utils_debug_1 = require("@hint/utils-debug");
const utils_string_1 = require("@hint/utils-string");
const utils_network_1 = require("@hint/utils-network");
const utils_types_1 = require("@hint/utils-types");
const meta_1 = require("./meta");
const i18n_import_1 = require("./i18n.import");
const debug = utils_debug_1.debug(__filename);
/*
 * ------------------------------------------------------------------------------
 * Public
 * ------------------------------------------------------------------------------
 */
class ValidateSetCookieHeaderHint {
    constructor(context) {
        /** If targetBrowsers contain ie 6, ie 7 or ie 8 */
        let supportOlderBrowsers;
        /**
         * A collection of accepted attributes
         * See https://stackoverflow.com/questions/19792038/what-does-priority-high-mean-in-the-set-cookie-header for details about the `priority` attribute.
         */
        const acceptedCookieAttributes = ['expires', 'max-age', 'domain', 'path', 'secure', 'httponly', 'samesite', 'priority'];
        /**
         * A collection of illegal characters in cookie name
         * Reference: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie#Directives
         */
        const illegalCookieNameChars = '()<>@,;:\"/[]?={}'; // eslint-disable-line no-useless-escape
        /**
         * A collection of illegal characters in cookie value
         * Reference: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie#Directives
         */
        const illegalCookieValueChars = ',;"/';
        /** Header name used in report */
        const headerName = 'set-cookie';
        /** Trim double quote from the value string. */
        const unquote = (value) => {
            return value.replace(/(^")|("$)/g, '');
        };
        /** Normalize the string before the first `=`, concat and unquote the strings after the first `=`. */
        const normalizeAfterSplitByEqual = (splitResult) => {
            const [key, ...value] = splitResult;
            return [utils_string_1.normalizeString(key), unquote(value.join('='))];
        };
        /**
         * `Set-Cookie` header parser based on the algorithm used by a user agent defined in the spec:
         * https://tools.ietf.org/html/rfc6265#section-5.2.1
         */
        const parse = (setCookieValue) => {
            const [nameValuePair, ...directivePairs] = setCookieValue.split(';');
            const [cookieName, cookieValue] = normalizeAfterSplitByEqual(nameValuePair.split('='));
            const setCookie = {
                name: cookieName,
                value: cookieValue
            };
            const errors = [];
            if (directivePairs[directivePairs.length - 1] === '') {
                errors.push({
                    message: i18n_import_1.getMessage('noTrilingSemicolon', context.language, [headerName, setCookie.name]),
                    severity: utils_types_1.Severity.hint
                });
                directivePairs.pop(); // remove the empty one to continue the parsing
            }
            directivePairs.forEach((part) => {
                const [directiveKey, directiveValue] = normalizeAfterSplitByEqual(part.split('='));
                let ok = true;
                if (!acceptedCookieAttributes.includes(directiveKey)) {
                    errors.push({
                        message: i18n_import_1.getMessage('unknownAttribute', context.language, [headerName, directiveKey]),
                        severity: utils_types_1.Severity.warning
                    });
                    ok = false;
                }
                if (setCookie[directiveKey]) {
                    errors.push({
                        message: i18n_import_1.getMessage('duplicatedDirective', context.language, [headerName, directiveKey]),
                        severity: utils_types_1.Severity.warning
                    });
                    ok = false;
                }
                if (ok) {
                    setCookie[directiveKey] = directiveValue || true;
                }
            });
            return { errors, setCookie };
        };
        const validASCII = (string) => {
            return (/^[\x00-\x7F]+$/).test(string); // eslint-disable-line no-control-regex
        };
        /**
         * Validate cookie name or value string.
         * https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie
         */
        const validString = (name, illegalChars) => {
            const includesIllegalChars = illegalChars.split('').some((char) => {
                return name.includes(char);
            });
            const includesWhiteSpace = (/\s/g).test(name);
            return validASCII(name) && !includesIllegalChars && !includesWhiteSpace;
        };
        /** Validate cookie name-value string. */
        const validateNameAndValue = (parsedSetCookie) => {
            const cookieName = parsedSetCookie.name;
            const errors = [];
            const noNameValueStringError = i18n_import_1.getMessage('noNameValueString', context.language, headerName);
            const invalidNameError = i18n_import_1.getMessage('invalidName', context.language, [headerName, cookieName]);
            const invalidValueError = i18n_import_1.getMessage('invalidValue', context.language, [headerName, cookieName]);
            const severity = utils_types_1.Severity.error;
            // Check name-value-string exists and it is before the first `;`.
            if (!cookieName || acceptedCookieAttributes.includes(cookieName)) {
                errors.push({ message: noNameValueStringError, severity });
                return errors;
            }
            // Validate cookie name.
            if (!validString(cookieName, illegalCookieNameChars)) {
                errors.push({ message: invalidNameError, severity });
            }
            // Validate cookie value.
            if (!validString(parsedSetCookie.value, illegalCookieValueChars)) {
                errors.push({ message: invalidValueError, severity });
            }
            return errors;
        };
        /** Validate cookie name prefixes. */
        const validatePrefixes = (parsedSetCookie) => {
            const cookieName = parsedSetCookie.name;
            const resource = parsedSetCookie.resource || '';
            const errors = [];
            const hasPrefixHttpError = i18n_import_1.getMessage('hasPrefixHttp', context.language, headerName);
            const noPathHasHostPrefixError = i18n_import_1.getMessage('noPathHasHostPrefix', context.language, headerName);
            const hasDomainHostPrefixError = i18n_import_1.getMessage('hasDomainHostPrefix', context.language, headerName);
            if ((cookieName.startsWith('__secure-') || cookieName.startsWith('__host-')) && !utils_network_1.isHTTPS(resource)) {
                errors.push({ message: hasPrefixHttpError, severity: utils_types_1.Severity.error });
            }
            if (cookieName.startsWith('__host-')) {
                if (!parsedSetCookie.path || parsedSetCookie.path !== '/') {
                    errors.push({ message: noPathHasHostPrefixError, severity: utils_types_1.Severity.error });
                }
                if (parsedSetCookie.domain) {
                    errors.push({ message: hasDomainHostPrefixError, severity: utils_types_1.Severity.error });
                }
            }
            return errors;
        };
        /** Validate `Secure` and `HttpOnly` attributes. */
        const validateSecurityAttributes = (parsedSetCookie) => {
            const cookieName = parsedSetCookie.name;
            const resource = parsedSetCookie.resource || '';
            const errors = [];
            const hasSecureHttpError = i18n_import_1.getMessage('hasSecureHttp', context.language, resource);
            const noSecureError = i18n_import_1.getMessage('noSecure', context.language, [headerName, cookieName]);
            const noHttpOnlyError = i18n_import_1.getMessage('noHttpOnly', context.language, [headerName, cookieName]);
            // Check against `Secure` directive if sites are insecure.
            if (!utils_network_1.isHTTPS(resource) && parsedSetCookie.secure) {
                errors.push({ message: hasSecureHttpError, severity: utils_types_1.Severity.error });
                return errors;
            }
            // Check for `Secure` directive if sites are secure.
            if (!parsedSetCookie.secure) {
                errors.push({ message: noSecureError, severity: utils_types_1.Severity.error });
            }
            // Check for `httpOnly` directive.
            if (!parsedSetCookie.httponly) {
                errors.push({ message: noHttpOnlyError, severity: utils_types_1.Severity.warning });
            }
            return errors;
        };
        /** Validate `Expire` date format. */
        const validateExpireDate = (parsedSetCookie) => {
            const cookieName = parsedSetCookie.name;
            const errors = [];
            if (!parsedSetCookie.expires) {
                return errors;
            }
            // Ref: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Date
            const utcTimeString = new Date(parsedSetCookie.expires).toUTCString();
            const invalidDateError = i18n_import_1.getMessage('invalidDate', context.language, [headerName, cookieName]);
            const invalidDateFormatError = i18n_import_1.getMessage('invalidDateFormat', context.language, [headerName, cookieName, utcTimeString]);
            if (utcTimeString === 'Invalid Date') {
                errors.push({ message: invalidDateError, severity: utils_types_1.Severity.error });
                return errors;
            }
            if (utils_string_1.normalizeString(utcTimeString) !== utils_string_1.normalizeString(parsedSetCookie.expires)) {
                errors.push({ message: invalidDateFormatError, severity: utils_types_1.Severity.warning });
            }
            return errors;
        };
        /** Validate the usage of `Max-Age` and `Expires` based on users' browser support matrix */
        const validateMaxAgeAndExpires = (parsedSetCookie) => {
            const cookieName = parsedSetCookie.name;
            const errors = [];
            const maxAgeCompatibilityMessage = i18n_import_1.getMessage('maxAgeCompatibility', context.language, [headerName, cookieName]);
            const maxAgeAndExpireDuplicateMessage = i18n_import_1.getMessage('maxAgeAndExpireDuplicate', context.language);
            if (supportOlderBrowsers) {
                /*
                 * When targetBrowsers contains IE 6, IE 7 or IE 8:
                 * `max-age` can't be used alone.
                 */
                if (parsedSetCookie['max-age'] && !parsedSetCookie.expires) {
                    errors.push({ message: maxAgeCompatibilityMessage, severity: utils_types_1.Severity.error });
                }
                return errors;
            }
            /*
             * When targetBrowsers only contains modern browsers:
             * `max-age` takes precedence so `expires` shouldn't be used.
             * Reference: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie#Directives
             */
            if (parsedSetCookie['max-age'] && parsedSetCookie.expires) {
                errors.push({ message: maxAgeAndExpireDuplicateMessage, severity: utils_types_1.Severity.hint });
            }
            return errors;
        };
        const loadHintConfigs = () => {
            supportOlderBrowsers = ['ie 6', 'ie 7', 'ie 8'].some((e) => {
                return context.targetedBrowsers.includes(e);
            });
        };
        const validate = ({ element, resource, response }) => {
            const defaultValidators = [
                validateNameAndValue,
                validatePrefixes,
                validateSecurityAttributes,
                validateExpireDate,
                validateMaxAgeAndExpires
            ];
            // This check does not apply if URI starts with protocols others than http/https.
            if (!utils_network_1.isRegularProtocol(resource)) {
                debug(`Check does not apply for URI: ${resource}`);
                return;
            }
            const rawSetCookieHeaders = response.headers && response.headers['set-cookie'] || '';
            if (!rawSetCookieHeaders) {
                return;
            }
            /**  The `chrome` connector concatenates all `set-cookie` headers to one string. */
            const setCookieHeaders = Array.isArray(rawSetCookieHeaders) ? rawSetCookieHeaders : rawSetCookieHeaders.split(/\n|\r\n/);
            const reportBatch = (errorMessages, codeLanguage, codeSnippet) => {
                errorMessages.forEach(({ message, severity }) => {
                    context.report(resource, message, {
                        codeLanguage,
                        codeSnippet,
                        element,
                        severity
                    });
                });
            };
            for (const setCookieHeader of setCookieHeaders) {
                const codeSnippet = `Set-Cookie: ${setCookieHeader}`;
                const codeLanguage = 'http';
                const { errors, setCookie: parsedSetCookie } = parse(setCookieHeader);
                if (errors) {
                    for (const { message, severity } of errors) {
                        context.report(resource, message, {
                            codeLanguage,
                            codeSnippet,
                            element,
                            severity
                        });
                    }
                }
                parsedSetCookie.resource = resource;
                defaultValidators.every((defaultValidator) => {
                    const messages = defaultValidator(parsedSetCookie);
                    if (messages.length) {
                        reportBatch(messages, codeLanguage, codeSnippet);
                        return false;
                    }
                    return true;
                });
            }
        };
        loadHintConfigs();
        context.on('fetch::end::*', validate);
    }
}
exports.default = ValidateSetCookieHeaderHint;
ValidateSetCookieHeaderHint.meta = meta_1.default;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGludC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9oaW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7R0FFRzs7QUFFSCxtREFBK0M7QUFDL0MscURBQXFEO0FBQ3JELHVEQUFpRTtBQUdqRSxtREFBNkM7QUFHN0MsaUNBQTBCO0FBQzFCLCtDQUEyQztBQUUzQyxNQUFNLEtBQUssR0FBRyxtQkFBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBRTVCOzs7O0dBSUc7QUFFSCxNQUFxQiwyQkFBMkI7SUFJNUMsWUFBbUIsT0FBb0I7UUFFbkMsbURBQW1EO1FBQ25ELElBQUksb0JBQTZCLENBQUM7UUFDbEM7OztXQUdHO1FBQ0gsTUFBTSx3QkFBd0IsR0FBRyxDQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxVQUFVLENBQUMsQ0FBQztRQUN4SDs7O1dBR0c7UUFDSCxNQUFNLHNCQUFzQixHQUFHLG1CQUFtQixDQUFDLENBQUMsd0NBQXdDO1FBQzVGOzs7V0FHRztRQUNILE1BQU0sdUJBQXVCLEdBQUcsTUFBTSxDQUFDO1FBQ3ZDLGlDQUFpQztRQUNqQyxNQUFNLFVBQVUsR0FBRyxZQUFZLENBQUM7UUFLaEMsK0NBQStDO1FBQy9DLE1BQU0sT0FBTyxHQUFHLENBQUMsS0FBYSxFQUFVLEVBQUU7WUFDdEMsT0FBTyxLQUFLLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxFQUFFLENBQUMsQ0FBQztRQUMzQyxDQUFDLENBQUM7UUFFRixxR0FBcUc7UUFDckcsTUFBTSwwQkFBMEIsR0FBRyxDQUFDLFdBQXFCLEVBQVksRUFBRTtZQUNuRSxNQUFNLENBQUMsR0FBRyxFQUFFLEdBQUcsS0FBSyxDQUFDLEdBQUcsV0FBVyxDQUFDO1lBRXBDLE9BQU8sQ0FBQyw4QkFBZSxDQUFDLEdBQUcsQ0FBRSxFQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFB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